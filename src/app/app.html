<div class="min-h-screen bg-gray-100 font-sans">
  
  <header class="bg-green-900 text-white shadow-xl">
    <div class="max-w-7xl mx-auto px-6 h-20 flex items-center justify-between">
      <div class="text-yellow-400 font-black text-3xl italic tracking-tighter">STORE<span class="text-white">SECURITY</span></div>
      <nav class="flex gap-4">
        <button (click)="vistaActual.set('productos')" [class.bg-green-700]="vistaActual() === 'productos'" class="px-4 py-2 rounded font-bold uppercase text-xs transition-all hover:bg-green-800">üì¶ Productos</button>
        <button (click)="vistaActual.set('maestros')" [class.bg-green-700]="vistaActual() === 'maestros'" class="px-4 py-2 rounded font-bold uppercase text-xs transition-all hover:bg-green-800">‚öôÔ∏è Categor√≠as</button>
      </nav>
    </div>
  </header>

  <main class="p-8 max-w-7xl mx-auto">
    
    @if (vistaActual() === 'productos') {
      <div class="flex justify-between items-center mb-6">
        <h2 class="text-2xl font-black text-gray-800 uppercase italic">Inventario de Productos</h2>
        <button (click)="abrirCrearProd()" class="bg-yellow-400 text-green-900 font-black px-6 py-2 rounded shadow hover:scale-105 transition-all uppercase text-xs">+ Nuevo Producto</button>
      </div>

      <div class="bg-white rounded-xl shadow-lg overflow-hidden border border-gray-200">
        <table class="w-full">
          <thead class="bg-gray-50 text-gray-500 uppercase text-[10px] font-bold">
            <tr>
              <th class="p-4 text-left">Producto</th>
              <th class="p-4 text-left">Precio/Stock</th>
              <th class="p-4 text-left">Categor√≠a / Sub</th>
              <th class="p-4 text-right">Acciones</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-100">
            @for (p of productos(); track p.id) {
              <tr class="hover:bg-green-50/30 transition-all">
                <td class="p-4 font-bold text-green-900">{{ p.nombre }} <p class="text-[10px] font-normal text-gray-400">{{p.descripcion}}</p></td>
                <td class="p-4">
                  <span class="text-green-700 font-black block">${{ p.precio }}</span>
                  <span class="text-xs text-gray-500">{{ p.stock }} unidades</span>
                </td>
                <td class="p-4 uppercase text-[9px] font-black">
                  <span class="bg-gray-100 px-2 py-1 rounded">{{ p.categoria }}</span>
                  @if (p.subcategoria) { <span class="mx-1 text-gray-300">/</span> <span class="bg-yellow-100 text-yellow-700 px-2 py-1 rounded">{{ p.subcategoria }}</span> }
                </td>
                <td class="p-4 text-right">
                  <button (click)="abrirEditarProd(p)" class="text-blue-500 hover:text-blue-700 font-bold text-[10px] mr-4 uppercase">Editar</button>
                  <button (click)="eliminarProd(p.id)" class="text-red-400 hover:text-red-600 font-bold text-[10px] uppercase">Borrar</button>
                </td>
              </tr>
            }
          </tbody>
        </table>
      </div>
    }

    @if (vistaActual() === 'maestros') {
      <div class="grid grid-cols-1 md:grid-cols-2 gap-8 animate-in slide-in-from-bottom-4 duration-300">
        
        <div class="bg-white p-6 rounded-xl shadow-lg border-t-4 border-green-800">
          <div class="flex justify-between items-center mb-6">
            <h3 class="font-black text-gray-700 uppercase italic">Categor√≠as Principales</h3>
            <button (click)="modalCat.set(true)" class="bg-green-800 text-yellow-400 px-4 py-1 rounded font-bold text-[10px] uppercase">+ A√±adir</button>
          </div>
          <div class="space-y-2">
            @for (c of categorias(); track c.id) {
              <div class="flex justify-between items-center p-3 bg-gray-50 rounded hover:bg-gray-100 transition-all">
                <span class="font-bold text-green-900">{{c.nombre}}</span>
                <button (click)="eliminarCat(c.id)" class="text-red-300 hover:text-red-500 text-xs font-bold">ELIMINAR</button>
              </div>
            }
          </div>
        </div>

        <div class="bg-white p-6 rounded-xl shadow-lg border-t-4 border-yellow-500">
          <div class="flex justify-between items-center mb-6">
            <h3 class="font-black text-gray-700 uppercase italic">Subcategor√≠as</h3>
            <button (click)="modalSub.set(true)" class="bg-yellow-500 text-white px-4 py-1 rounded font-bold text-[10px] uppercase">+ A√±adir</button>
          </div>
          <div class="space-y-2">
            @for (s of subcategoriasTotales(); track s.id) {
              <div class="flex justify-between items-center p-3 bg-gray-50 rounded hover:bg-gray-100 transition-all border-l-4 border-yellow-500">
                <div>
                  <span class="font-bold text-gray-800 block leading-none">{{s.nombre}}</span>
                  <span class="text-[9px] uppercase text-gray-400">Padre: {{s.categoriaPadre}}</span>
                </div>
                <button (click)="eliminarSub(s.id)" class="text-red-300 hover:text-red-500 text-xs font-bold">ELIMINAR</button>
              </div>
            }
          </div>
        </div>

      </div>
    }
  </main>

  @if (modalProd()) {
    <div class="fixed inset-0 bg-black/60 backdrop-blur-sm z-[200] flex items-center justify-center p-4">
      <div class="bg-white rounded-2xl w-full max-w-md shadow-2xl overflow-hidden animate-in zoom-in duration-200">
        <div class="bg-green-800 p-4 text-yellow-400 font-black uppercase italic flex justify-between">
          <span>{{ esEdicion() ? 'Editar' : 'Nuevo' }} Producto</span>
          <button (click)="modalProd.set(false)" class="text-white">‚úï</button>
        </div>
        <div class="p-6 space-y-4">
          <input [(ngModel)]="formProd().nombre" placeholder="Nombre *" class="w-full border-b-2 p-2 outline-none font-bold">
          <div class="grid grid-cols-2 gap-4">
            <input type="number" [(ngModel)]="formProd().precio" placeholder="Precio *" class="w-full border-b-2 p-2 outline-none">
            <input type="number" [(ngModel)]="formProd().stock" placeholder="Stock *" class="w-full border-b-2 p-2 outline-none">
          </div>
          <select [ngModel]="formProd().categoriaId" (change)="cambioCatProd($event)" class="w-full border-b-2 p-2 bg-white outline-none font-bold">
            <option [value]="null" disabled>1. Categor√≠a Principal...</option>
            @for (c of categorias(); track c.id) { <option [value]="c.id">{{c.nombre}}</option> }
          </select>
          @if (subcategoriasFiltradas().length > 0) {
            <select [(ngModel)]="formProd().subcategoriaId" class="w-full border-b-2 p-2 bg-white outline-none font-bold animate-in slide-in-from-top-2">
              <option [value]="null" disabled>2. Subcategor√≠a...</option>
              @for (s of subcategoriasFiltradas(); track s.id) { <option [value]="s.id">{{s.nombre}}</option> }
            </select>
          }
        </div>
        <div class="bg-gray-50 p-4 flex justify-end gap-3">
          <button (click)="modalProd.set(false)" class="text-gray-400 font-bold uppercase text-[10px]">Cerrar</button>
          <button (click)="guardarProd()" class="bg-green-800 text-yellow-400 px-8 py-2 rounded-lg font-black uppercase text-xs">Guardar</button>
        </div>
      </div>
    </div>
  }

  @if (modalCat()) {
    <div class="fixed inset-0 bg-black/60 flex items-center justify-center z-[200] p-4">
      <div class="bg-white rounded-xl p-6 w-full max-w-xs shadow-2xl animate-in zoom-in">
        <h3 class="font-black text-green-900 uppercase italic mb-4">Nueva Categor√≠a</h3>
        <input [(ngModel)]="formCat().nombre" placeholder="Nombre Categor√≠a..." class="w-full border-b-2 p-2 outline-none font-bold mb-6">
        <div class="flex justify-end gap-3">
          <button (click)="modalCat.set(false)" class="text-gray-400 text-[10px] font-bold">CANCELAR</button>
          <button (click)="guardarCat()" class="bg-green-800 text-yellow-400 px-4 py-2 rounded font-black text-[10px]">CREAR</button>
        </div>
      </div>
    </div>
  }

  @if (modalSub()) {
    <div class="fixed inset-0 bg-black/60 flex items-center justify-center z-[200] p-4">
      <div class="bg-white rounded-xl p-6 w-full max-w-xs shadow-2xl animate-in zoom-in">
        <h3 class="font-black text-yellow-600 uppercase italic mb-4">Nueva Subcategor√≠a</h3>
        <input [(ngModel)]="formSub().nombre" placeholder="Nombre Sub..." class="w-full border-b-2 p-2 outline-none font-bold mb-4">
        <select [(ngModel)]="formSub().categoriaId" class="w-full border-b-2 p-2 bg-white outline-none font-bold mb-6">
          <option [value]="null" disabled>Elegir Padre...</option>
          @for (c of categorias(); track c.id) { <option [value]="c.id">{{c.nombre}}</option> }
        </select>
        <div class="flex justify-end gap-3">
          <button (click)="modalSub.set(false)" class="text-gray-400 text-[10px] font-bold">CANCELAR</button>
          <button (click)="guardarSub()" class="bg-yellow-500 text-white px-4 py-2 rounded font-black text-[10px]">CREAR</button>
        </div>
      </div>
    </div>
  }
</div>